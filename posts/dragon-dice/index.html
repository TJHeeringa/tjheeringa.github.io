<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

  <meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.433">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


  <title></title>
  <style>
    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    div.columns {
      display: flex;
      gap: min(4vw, 1.5em);
    }

    div.column {
      flex: auto;
      overflow-x: auto;
    }

    div.hanging-indent {
      margin-left: 1.5em;
      text-indent: -1.5em;
    }

    ul.task-list {
      list-style: none;
    }

    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em;
      /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */
      vertical-align: middle;
    }

    /* CSS for syntax highlighting */
    pre>code.sourceCode {
      white-space: pre;
      position: relative;
    }

    pre>code.sourceCode>span {
      display: inline-block;
      line-height: 1.25;
    }

    pre>code.sourceCode>span:empty {
      height: 1.2em;
    }

    .sourceCode {
      overflow: visible;
    }

    code.sourceCode>span {
      color: inherit;
      text-decoration: inherit;
    }

    div.sourceCode {
      margin: 1em 0;
    }

    pre.sourceCode {
      margin: 0;
    }

    @media screen {
      div.sourceCode {
        overflow: auto;
      }
    }

    @media print {
      pre>code.sourceCode {
        white-space: pre-wrap;
      }

      pre>code.sourceCode>span {
        text-indent: -5em;
        padding-left: 5em;
      }
    }

    pre.numberSource code {
      counter-reset: source-line 0;
    }

    pre.numberSource code>span {
      position: relative;
      left: -4em;
      counter-increment: source-line;
    }

    pre.numberSource code>span>a:first-child::before {
      content: counter(source-line);
      position: relative;
      left: -1em;
      text-align: right;
      vertical-align: baseline;
      border: none;
      display: inline-block;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      padding: 0 4px;
      width: 4em;
    }

    pre.numberSource {
      margin-left: 3em;
      padding-left: 4px;
    }

    div.sourceCode {}

    @media screen {
      pre>code.sourceCode>span>a:first-child::before {
        text-decoration: underline;
      }
    }
  </style>

  
  <link type="text/css" href="/static/blog/shared.css" rel="stylesheet" />
  <link type="text/css" href="/static/blog/nav.css" rel="stylesheet" />

  <script type="text/javascript" src="/static/blog/notebooks/clipboard/clipboard.min.js"></script>
  <script type="text/javascript" src="/static/blog/notebooks/quarto-html/quarto.js"></script>
  <script type="text/javascript" src="/static/blog/notebooks/quarto-html/popper.min.js"></script>
  <script type="text/javascript" src="/static/blog/notebooks/quarto-html/tippy.umd.min.js"></script>
  <script type="text/javascript" src="/static/blog/notebooks/quarto-html/anchor.min.js"></script>

  <link href="/static/blog/notebooks/quarto-html/tippy.css" rel="stylesheet">
  <link href="/static/blog/notebooks/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
  <script type="text/javascript" src="/static/blog/notebooks/bootstrap/bootstrap.min.js"></script>
  <link href="/static/blog/notebooks/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="/static/blog/notebooks/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"
    integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
    crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [], function () { return window.jQuery; })</script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <script type="text/javascript">
    window.PlotlyConfig = { MathJaxConfig: 'local' };
    if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) { window.MathJax.Hub.Config({ SVG: { font: "STIX-Web" } }); }
    if (typeof require !== 'undefined') {
      require.undef("plotly");
      requirejs.config({
        paths: {
          'plotly': ['https://cdn.plot.ly/plotly-2.24.1.min']
        }
      });
      require(['plotly'], function (Plotly) {
        window._Plotly = Plotly;
      });
    }
  </script>



</head>

<body class="">
  <nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
    <div class="container px-5 w-100">
        <a class="navbar-brand" href="/"><span class="fw-bolder text-title">Tjeerd Jan Heeringa</span></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 small fw-bolder">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/posts">Blog</a></li>
                <li class="nav-item"><a class="nav-link" href="/talks">Talks</a></li>
                <li class="nav-item"><a class="nav-link" href="/papers">Papers</a></li>
                <li class="nav-item"><a class="nav-link" href="/posters">Posters</a></li>
                <li class="nav-item"><a class="nav-link" href="/collaborators">Collaborators</a></li>
            </ul>
        </div>
    </div>
</nav>
  
    




<div class="page-columns page-rows-contents page-layout-article" id="quarto-content">
<main class="content" id="quarto-document-content">
<header class="quarto-title-block default" id="title-block-header">
<div class="quarto-title">
<h1 class="title">Dragon dice</h1>
<p class="subtitle lead">Which number do you choose?</p>
</div>
<div class="quarto-title-meta">
<div>
<div class="quarto-title-meta-heading">Author</div>
<div class="quarto-title-meta-contents">
<p>T.J. Heeringa </p>
</div>
</div>
<div>
<div class="quarto-title-meta-heading">Published</div>
<div class="quarto-title-meta-contents">
<p class="date">November 1, 2023</p>
</div>
</div>
</div>
<div>
<div class="abstract">
<div class="abstract-title">Abstract</div>
<p>In this post, we study the Dragon Dice problem of Numberphile.</p>
</div>
</div>
</header>
<section class="level2" id="introduction">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>“On one of your adventures you find the entrance to a dungeon. Once inside, you meet a dragon. The dragon corners you and says: ‘I will give you a die. If you manage to throw exactly a number of your choosing, then I will let you go. Otherwise, you will be stuck here with me forever. What number do you choose?’” This is roughly the story that Numberphile uses to introduce us to the problem in <a href=""></a>. They say the number you should choose is the number of eyes on your die, and otherwise the number closest to <span class="math inline">\(e-1\)</span> times the eyes on your die. They do not provicde a proof for that, so in this post we will give you one.</p>
</section>
<section class="level2" id="the-dragon-dice-problem">
<h2 class="anchored" data-anchor-id="the-dragon-dice-problem">The dragon dice problem</h2>
<p>The problem can be expressed more rigorrously in the following form. Consider a fair die with <span class="math inline">\(n\)</span> eyes. You throw continuously with this die. Everytime you throw, you add the eyes of your current throw to your previous result. You win if you throw a beforehandly picked number. You loose if you exceed it. What number has the highest probability of you winning?</p>
<p>This problem is fairly simple, so the actual problem of interest is: What number above <span class="math inline">\(n\)</span> has the highest probability of you winning?</p>
</section>
<section class="level2" id="the-probability-distribution">
<h2 class="anchored" data-anchor-id="the-probability-distribution">The probability distribution</h2>
<p>The die is fair, so <span class="math inline">\(\mathbb{P}(1)=1/n\)</span>. Since you keep adding the current eyes to your previous result, the probability for <span class="math inline">\(k=2\)</span> is <span class="math display">\[
  \mathbb{P}(2) = 1/n + 1/n\mathbb{P}(1).
\]</span> For <span class="math inline">\(k=3\)</span>, we have <span class="math display">\[
  \mathbb{P}(3) = 1/n + 1/n\mathbb{P}(2) + 1/n\mathbb{P}(1).
\]</span> This pattern repeats until <span class="math inline">\(k=n\)</span>. For <span class="math inline">\(k=n+1\)</span>, we can no longer get to the number in a single throw. Hence, the overall probability distribution is given by <span class="math display">\[
  \mathbb{P}(k) =  \begin{cases}
  \frac{1}{n}+\frac{1}{n}\sum_{m=1}^{k-1 }\mathbb{P}(m) &amp; k \leq n \\
  \frac{1}{n}\sum_{m=k-n-1}^{k-1 }\mathbb{P}(m) &amp; k &gt; n
\end{cases}
\]</span></p>
</section>
<section class="level2" id="simulations">
<h2 class="anchored" data-anchor-id="simulations">Simulations</h2>
<p>It’s always a good idea to do some numerical simulations to get an idea for the answer. In this case, we will compute the probabilities for several small <span class="math inline">\(n\)</span>.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a><span class="kw">class</span> Probability:</span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dice_size: <span class="bu">int</span>, end<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>    <span class="va">self</span>.dice_size <span class="op">=</span> dice_size</span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a>    <span class="va">self</span>.count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>    <span class="va">self</span>.probabilities <span class="op">=</span> []</span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a>    <span class="va">self</span>.end <span class="op">=</span> <span class="dv">3</span><span class="op">*</span><span class="va">self</span>.dice_size <span class="cf">if</span> end <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> end</span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7" tabindex="-1"></a>    </span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__iter__</span>(<span class="va">self</span>):</span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9" tabindex="-1"></a>    <span class="va">self</span>.count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__next__</span>(<span class="va">self</span>):</span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13" tabindex="-1"></a>    <span class="va">self</span>.count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.count <span class="op">&lt;=</span> <span class="bu">len</span>(<span class="va">self</span>.probabilities):</span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">self</span>.probabilities[<span class="va">self</span>.count]</span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16" tabindex="-1"></a>    </span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.count <span class="op">&gt;</span> <span class="va">self</span>.end:</span>
<span id="cb2-18"><a aria-hidden="true" href="#cb2-18" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">StopIteration</span></span>
<span id="cb2-19"><a aria-hidden="true" href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a aria-hidden="true" href="#cb2-20" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.count <span class="op">&lt;=</span> <span class="va">self</span>.dice_size:</span>
<span id="cb2-21"><a aria-hidden="true" href="#cb2-21" tabindex="-1"></a>      prob <span class="op">=</span> <span class="bu">sum</span>(<span class="va">self</span>.probabilities[:<span class="va">self</span>.count]) <span class="op">/</span> <span class="va">self</span>.dice_size <span class="op">+</span> <span class="dv">1</span><span class="op">/</span><span class="va">self</span>.dice_size</span>
<span id="cb2-22"><a aria-hidden="true" href="#cb2-22" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-23"><a aria-hidden="true" href="#cb2-23" tabindex="-1"></a>      prob <span class="op">=</span> <span class="bu">sum</span>(<span class="va">self</span>.probabilities[<span class="va">self</span>.count<span class="op">-</span><span class="va">self</span>.dice_size<span class="op">-</span><span class="dv">1</span>:<span class="va">self</span>.count]) <span class="op">/</span> <span class="va">self</span>.dice_size</span>
<span id="cb2-24"><a aria-hidden="true" href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a aria-hidden="true" href="#cb2-25" tabindex="-1"></a>    <span class="va">self</span>.probabilities.append(prob)</span>
<span id="cb2-26"><a aria-hidden="true" href="#cb2-26" tabindex="-1"></a>    <span class="cf">return</span> prob</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a>plt.figure()</span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>,<span class="dv">25</span>):</span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a>  plt.plot(<span class="bu">list</span>(Probability(n, end<span class="op">=</span><span class="dv">75</span>)), label<span class="op">=</span><span class="bu">str</span>(n), marker<span class="op">=</span><span class="st">"x"</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img height="411" src="/static/blog/notebooks/dragon_dice/cell-4-output-1.png" width="579"/></p>
</div>
</div>
<p>In this figure, we have plotted these probabilities. The lines are ordered from top to bottom with increasing <span class="math inline">\(n\)</span>. We see that there are three stages. The first is the monotone increasing part corresponding to the numbers up to <span class="math inline">\(n\)</span>. The second is a parabola that goes from <span class="math inline">\(n\)</span> to roughly <span class="math inline">\(2n\)</span>. After <span class="math inline">\(2n\)</span> the run is more or less flat. The probabilities up to <span class="math inline">\(n\)</span> overlap with the runs above, so let’s plot the probabilities from <span class="math inline">\(n\)</span> onwards.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a>plt.figure()</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>,<span class="dv">25</span>):</span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a>  plt.plot(<span class="bu">list</span>(Probability(n))[n:], marker<span class="op">=</span><span class="st">"x"</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img height="411" src="/static/blog/notebooks/dragon_dice/cell-5-output-1.png" width="579"/></p>
</div>
</div>
<p>In each of these runs, there is a clear maximum. This maximum also shifts to the right as <span class="math inline">\(n\)</span> increases. Let’s plot the relation between these two variables.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3" tabindex="-1"></a>maxes <span class="op">=</span> []</span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4" tabindex="-1"></a>argmaxes <span class="op">=</span> []</span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5" tabindex="-1"></a>argmaxes_normalized <span class="op">=</span> []</span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6" tabindex="-1"></a>dice_sizes <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">6</span>,<span class="dv">100</span>))</span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7" tabindex="-1"></a><span class="cf">for</span> dice_size <span class="kw">in</span> dice_sizes:</span>
<span id="cb5-8"><a aria-hidden="true" href="#cb5-8" tabindex="-1"></a>  maxes.append(</span>
<span id="cb5-9"><a aria-hidden="true" href="#cb5-9" tabindex="-1"></a>    np.<span class="bu">max</span>(<span class="bu">list</span>(Probability(dice_size))[dice_size:])</span>
<span id="cb5-10"><a aria-hidden="true" href="#cb5-10" tabindex="-1"></a>  )</span>
<span id="cb5-11"><a aria-hidden="true" href="#cb5-11" tabindex="-1"></a>  argmaxes.append(</span>
<span id="cb5-12"><a aria-hidden="true" href="#cb5-12" tabindex="-1"></a>    dice_size<span class="op">+</span>np.argmax(<span class="bu">list</span>(Probability(dice_size))[dice_size:])</span>
<span id="cb5-13"><a aria-hidden="true" href="#cb5-13" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a aria-hidden="true" href="#cb5-14" tabindex="-1"></a>  argmaxes_normalized.append(</span>
<span id="cb5-15"><a aria-hidden="true" href="#cb5-15" tabindex="-1"></a>    (dice_size <span class="op">+</span> np.argmax(<span class="bu">list</span>(Probability(dice_size))[dice_size:])) <span class="op">/</span> dice_size</span>
<span id="cb5-16"><a aria-hidden="true" href="#cb5-16" tabindex="-1"></a>  )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1" tabindex="-1"></a>plt.figure()</span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2" tabindex="-1"></a>plt.plot(dice_sizes, argmaxes, marker<span class="op">=</span><span class="st">"x"</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img height="411" src="/static/blog/notebooks/dragon_dice/cell-7-output-1.png" width="575"/></p>
</div>
</div>
<p>This is roughly a straight line. This suggests we should not plot the maximum against <span class="math inline">\(n\)</span>, but the maximum devided by <span class="math inline">\(n\)</span> against <span class="math inline">\(n\)</span>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1" tabindex="-1"></a>plt.figure()</span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2" tabindex="-1"></a>plt.plot(dice_sizes, argmaxes_normalized, marker<span class="op">=</span><span class="st">"x"</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img height="411" src="/static/blog/notebooks/dragon_dice/cell-8-output-1.png" width="579"/></p>
</div>
</div>
<p>This shows us that the relation has a slope of approximately <span class="math inline">\(1.72\)</span>. This is not clearly an nice number like <span class="math inline">\(\pi\)</span> or <span class="math inline">\(\sqrt{2}\)</span>, but is fairly close to <span class="math inline">\(\sqrt{3}\)</span> and <span class="math inline">\(e-1\)</span>.</p>
</section>
<section class="level2" id="computing-the-bound">
<h2 class="anchored" data-anchor-id="computing-the-bound">Computing the bound</h2>
<p>One of the ways to compute <span class="math inline">\(e\)</span> is using the limit <span class="math display">\[
  e=\lim_{n\to\inf}(1+\frac{1}{n})^n.
\]</span> We have plenty of <span class="math inline">\(\frac{1}{n}\)</span> terms, so we are going to guess that we are lookign for a term like <span class="math inline">\((e-1)n\)</span>. Since we have an expression for <span class="math inline">\(\mathbb{P}(k)\)</span>, we can confirm whether that is true.</p>
<section class="level3" id="for-kleq-n">
<h3 class="anchored" data-anchor-id="for-kleq-n">For <span class="math inline">\(k\leq n\)</span></h3>
<p>In order to compute <span class="math inline">\(\mathbb{P}(1.7n)\)</span>, we start by computing <span class="math inline">\(\mathbb{P}(k)\)</span> for all <span class="math inline">\(k\leq n\)</span>. The two terms are given by <span class="math display">\[
  \mathbb{P}(1) = \frac{1}{n} \quad
  \mathbb{P}(2) = \frac{1}{n}+\frac{1}{n}(\frac{1}{n}) = \frac{1}{n}+\frac{1}{n^2}
\]</span> The third is a little more elaborate to work out, but is <span class="math display">\[
  \mathbb{P}(3) = \frac{1}{n}+\frac{1}{n}\bigg(\mathbb{P}(2)+\mathbb{P}(1)\bigg) = \frac{1}{n}+\frac{1}{n}\bigg(\frac{1}{n}+\frac{1}{n^2}+\frac{1}{n}\bigg) = \frac{1}{n}+\frac{2}{n^2}+\frac{1}{n^3}.
\]</span> If we factor out a <span class="math inline">\(\frac{1}{n}\)</span>, then we get a <span class="math inline">\(1+\frac{2}{n}+\frac{1}{n^2}=(1+\frac{1}{n})^2\)</span>. So, we expect that <span id="eq-prob-k-small"><span class="math display">\[
  \mathbb{P}(k) = \frac{1}{n}(1+\frac{1}{n})^{k-1}
\tag{1}\]</span></span> for all <span class="math inline">\(k\leq n\)</span>. With a few lines of mathematica we can check our assertion.</p>
<pre class="{mathematica}"><code>P[k_, n_] := 
 P[k, n] = 
  Piecewise[{{1/n, k == 1}, {1/n + 1/n Sum[P[m, n], {m, 1, k - 1}], 
     k &lt;= n}, {1/n Sum[P[m, n], {m, k - n, k - 1}], k &gt; n}}]

Table[Simplify[Refine[P[k, n], n &gt;= 10]], {k, 1, 9}]</code></pre>
<p>This gives us <span class="math display">\[
\left\{\frac{1}{n},\frac{n+1}{n^2},\frac{(n+1)^2}{n^3},\frac{(n+1)^3}{n^4},\frac{(n+1)^4}{n^5},\frac{(n+1)^5}{n^6},\frac{(n+1)^6}{n^7},\frac{(n+1)^7}{n^8},\frac{(n+1)^8}{n^9}\right\},
\]</span> confirming our guess. In fact, this is straightforward to show using a proof by induction.</p>
<!-- ::: {#lem-prob-k-small}
@eq-prob-k-small holds for all $k\leq n$.
::: -->
</section>
<section class="level3" id="for-nk2n">
<h3 class="anchored" data-anchor-id="for-nk2n">For <span class="math inline">\(n&lt;k&lt;2n\)</span></h3>
<p>For <span class="math inline">\(k=n+d\)</span> with <span class="math inline">\(0&lt;d&lt;n\)</span>, we have to compute for <span class="math inline">\(\mathbb{P}(k)\)</span> the sum of the probabilities of the last <span class="math inline">\(n-d\)</span> values with <span class="math inline">\(k\leq n\)</span>. A quick check using mathematica shows that the closed form for this is <span class="math display">\[
  \sum_{m=d}^n\mathbb{P}(m) = n^{-n-1} (n+1)^{n-z-1} \left((n+1)^{z+1}-n^{z+1}\right).
\]</span> The code that we used for this is</p>
<pre class="{mathematica}"><code>probMin[d_, n_] := 
  probMin[z, n] = 1/nSum[1/n(1 + 1/n)^(m - 1), {m, n - d, n}]
probMin2[d_, n_] := 
 probMin2[d, n] = n^(-1 - n) (1 + n)^(n - d - 1) ((1 + n)^(d + 1) - n^(d + 1))

Table[Simplify[probMin[d, n] - probMin2[d, n]], {d, 0, 10}]</code></pre>
<p>with output <span class="math display">\[
\{0,0,0,0,0,0,0,0,0,0,0\}.
\]</span> With this we can write <span class="math inline">\(\mathbb{P}(k)\)</span> for <span class="math inline">\(n&lt;k&lt;2n\)</span> as</p>
<pre class="{mathematica}"><code>prob[d_, n_] := 
 prob[d, n] = 
  Piecewise[{{probMin[n - d - 1, n] + 
      1/n Sum[prob[m, n], {m, 0, d - 1}], d &gt;= 0}}]</code></pre>
<p>When we tabulate the first few expressions, we see a clear pattern emerge.</p>
<pre class="{mathematica}"><code>Table[{d, prob[d, n] // FullSimplify}, {d, 0, 5}] // TableForm</code></pre>
<p><span class="math display">\[
\begin{align}
\bigg\{&amp;\frac{\left(\frac{1}{n}+1\right)^n-1}{n},\frac{(n+1) \left(\frac{1}{n}+1\right)^n-n-2}{n^2},\frac{(n+1)^{n+2} n^{-n}-(n+4) n-3}{n^3},\\&amp;\frac{(n+1)^2 \left((n+1) \left(\frac{1}{n}+1\right)^n-n-4\right)}{n^4},\frac{(n+1)^3 \left((n+1) \left(\frac{1}{n}+1\right)^n-n-5\right)}{n^5}\bigg\}
\end{align}
\]</span> This pattern we can capture in</p>
<pre class="{mathematica}"><code>prob2[d_, n_] := 
 prob2[d, n] = ((1 + n)^(d - 1) (-1 - d - n + (1 + 1/n)^n (1 + n)))/
  n^(d + 1)</code></pre>
<p>We can empircally confirm that this is indeed the expression that we are looking for.</p>
<pre class="{mathematica}"><code>Table[FullSimplify[prob[d, n] - prob2[d, n]], {d, 0, 15}]</code></pre>
<p><span class="math display">\[
\{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\}.
\]</span></p>
</section>
<section class="level3" id="finding-the-decrease">
<h3 class="anchored" data-anchor-id="finding-the-decrease">Finding the decrease</h3>
<p>Now we have the expression <span id="eq-prob-k-bigg"><span class="math display">\[
  \mathbb{P}(k) = \frac{(1+n)^{d-1}\bigg(-1-d-n+(1+1/n)^n(1+n)\bigg)}{n^{d+1}}
\tag{2}\]</span></span> for all <span class="math inline">\(k=n+d\)</span> with <span class="math inline">\(0&lt;d\leq n\)</span>. From the simulations we can deduce that there is a single maximum and the curve has no local maxima. So, we can find the maximum by looking for the first point is decreases, i.e. to find the smallest <span class="math inline">\(d\)</span> for which <span class="math display">\[
  \mathbb{P}(n+d-1)\leq \mathbb{P}(n+d).
\]</span> Substituting <a href="#eq-prob-k-bigg">Equation 2</a> into this gives <span class="math display">\[
n^{-d-1} (n+1)^{d-2} \left(-d+(n+1) \left(1+\frac{1}{n}\right)^n-2 n-1\right) \leq 0.
\]</span> The terms outside the bracket do not change the sign, so let’s focus on the stuff inside the bracket, i.e. look at <span class="math display">\[
  -d+(n+1) \left(1+\frac{1}{n}\right)^n-2 n-1 \leq 0.
\]</span> When we move <span class="math inline">\(d+1\)</span> to the other side and devide both side by <span class="math inline">\(n\)</span>, we get <span class="math display">\[
  \frac{n+1}{n}\left(1+\frac{1}{n}\right)^n-2 \leq \frac{d+1}{n}.
\]</span> For large values of <span class="math inline">\(n\)</span>, we have <span class="math display">\[
  \frac{n+1}{n} \approx 1
\]</span> and <span class="math display">\[
\left(1+\frac{1}{n}\right)^n \approx e.
\]</span> Hence, we got approximately <span class="math display">\[
  d \geq n(e-2)-1.
\]</span> This implies the smallest <span class="math inline">\(k\)</span> larger than <span class="math inline">\(n\)</span> with the highest probability is approximately for large values of <span class="math inline">\(n\)</span> given by <span class="math display">\[
  k_{opt}(n) = \inf\{k | k \geq n(e-1)-1 \}.
\]</span> The smallest integer bigger than some number is the ceil of the number, so <span id="eq-opt"><span class="math display">\[
  k_{opt}(n) = \lceil n(e-1)-1 \rceil.
\tag{3}\]</span></span> Let’s confirm to that is indeed the right number by highlighting it in the probabilities figure.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a aria-hidden="true" href="#cb14-1" tabindex="-1"></a>plt.figure()</span>
<span id="cb14-2"><a aria-hidden="true" href="#cb14-2" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>,<span class="dv">25</span>):</span>
<span id="cb14-3"><a aria-hidden="true" href="#cb14-3" tabindex="-1"></a>  probabilities <span class="op">=</span> <span class="bu">list</span>(Probability(n))[n:]</span>
<span id="cb14-4"><a aria-hidden="true" href="#cb14-4" tabindex="-1"></a>  d_opt <span class="op">=</span> <span class="bu">int</span>(np.ceil(n<span class="op">*</span>(np.exp(<span class="dv">1</span>)<span class="op">-</span><span class="dv">2</span>))<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb14-5"><a aria-hidden="true" href="#cb14-5" tabindex="-1"></a>  plt.plot(probabilities, marker<span class="op">=</span><span class="st">"x"</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb14-6"><a aria-hidden="true" href="#cb14-6" tabindex="-1"></a>  plt.plot(d_opt, probabilities[d_opt], marker<span class="op">=</span><span class="st">"o"</span>, c<span class="op">=</span><span class="st">"black"</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img height="411" src="/static/blog/notebooks/dragon_dice/cell-9-output-1.png" width="579"/></p>
</div>
</div>
<p>We see that these match nicely, so <a href="#eq-opt">Equation 3</a> is indeed the solution.</p>
</section>
</section>
</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div>
  
</body>

</html>